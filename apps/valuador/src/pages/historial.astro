---
import MainLayout from '../layouts/MainLayout.astro';
import HistorialValuaciones from '../components/HistorialValuaciones.jsx';

// Datos de ejemplo para el historial de valuaciones
const valuaciones = [
  {
    id: "5432",
    fecha: "15/05/2025",
    cliente: {
      nombre: "María Rodríguez",
      telefono: "5512345678",
      email: "maria@ejemplo.com"
    },
    productos: 3,
    totalCompra: 1250.50,
    totalVenta: 2340.75,
    estado: "finalizada"
  },
  {
    id: "5431",
    fecha: "14/05/2025",
    cliente: {
      nombre: "Juan Pérez",
      telefono: "5587654321",
      email: "juan@ejemplo.com"
    },
    productos: 1,
    totalCompra: 450.00,
    totalVenta: 899.99,
    estado: "finalizada"
  },
  {
    id: "5430",
    fecha: "13/05/2025",
    cliente: {
      nombre: "Ana López",
      telefono: "5523456789"
    },
    productos: 5,
    totalCompra: 3200.75,
    totalVenta: 5780.50,
    estado: "pendiente"
  },
  {
    id: "5429",
    fecha: "12/05/2025",
    cliente: {
      nombre: "Roberto Sánchez",
      telefono: "5534567890",
      email: "roberto@ejemplo.com"
    },
    productos: 2,
    totalCompra: 980.25,
    totalVenta: 1750.00,
    estado: "cancelada"
  },
  {
    id: "5428",
    fecha: "11/05/2025",
    cliente: {
      nombre: "Carmen Ramírez",
      telefono: "5545678901"
    },
    productos: 4,
    totalCompra: 1890.30,
    totalVenta: 3450.75,
    estado: "finalizada"
  }
];

// Estadísticas
const estadisticas = {
  totalValuaciones: valuaciones.length,
  valuacionesFinalizadas: valuaciones.filter(v => v.estado === "finalizada").length,
  valuacionesPendientes: valuaciones.filter(v => v.estado === "pendiente").length,
  totalProductos: valuaciones.reduce((sum, v) => sum + v.productos, 0),
  totalVenta: valuaciones
    .filter(v => v.estado === "finalizada")
    .reduce((sum, v) => sum + v.totalVenta, 0)
};
---

<MainLayout title="Historial de Valuaciones">
  <HistorialValuaciones client:only="react" />
</MainLayout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const busquedaInput = document.getElementById('busqueda');
    const estadoSelect = document.getElementById('estado');
    const fechaDesdeInput = document.getElementById('fecha-desde');
    const fechaHastaInput = document.getElementById('fecha-hasta');
    const filtrarBtn = document.getElementById('filtrar-btn');
    
    // Simulación de filtrado
    filtrarBtn?.addEventListener('click', () => {
      const busqueda = (busquedaInput as HTMLInputElement)?.value.toLowerCase() || '';
      const estado = (estadoSelect as HTMLSelectElement)?.value || '';
      const fechaDesde = (fechaDesdeInput as HTMLInputElement)?.value || '';
      const fechaHasta = (fechaHastaInput as HTMLInputElement)?.value || '';
      
      alert(`Filtros aplicados:
        Búsqueda: ${busqueda}
        Estado: ${estado}
        Desde: ${fechaDesde}
        Hasta: ${fechaHasta}
        
        En una implementación real, estos filtros se enviarían al servidor para obtener resultados filtrados.`);
    });
    
    // Implementar impresión de valuación individual
    const imprimirBtns = document.querySelectorAll('[title="Imprimir"]');
    imprimirBtns.forEach(btn => {
      btn.addEventListener('click', function(this: HTMLElement) {
        const fila = this.closest('tr');
        const id = fila?.querySelector('td:first-child')?.textContent?.trim();
        
        if (id) {
          alert(`Se imprimirá la valuación ${id}. En una implementación real, se generaría un PDF o se abriría la vista de impresión.`);
        }
      });
    });
  });
</script> 