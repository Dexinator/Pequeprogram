---
import MainLayout from '../layouts/MainLayout.astro';
import ImageUploader from '../components/ImageUploader.astro';
---

<MainLayout title="Nueva Valuación">
  <div class="space-y-6">
    <div class="flex justify-between items-center">
      <h1 class="text-3xl font-heading font-bold text-azul-profundo">Nueva Valuación</h1>
      <span class="bg-amarillo text-white text-sm py-1 px-3 rounded-full">ID: VP-{Math.floor(Math.random() * 10000).toString().padStart(4, '0')}</span>
    </div>
    
    <p class="text-text-muted">
      Complete los datos del artículo para obtener una valuación precisa. Los campos marcados con 
      <span class="text-rosa">*</span> son obligatorios.
    </p>

    <form class="mt-6 space-y-8">
      <!-- Datos básicos -->
      <div class="bg-background-alt p-6 rounded-lg shadow-sm border border-border">
        <h2 class="text-xl font-heading font-bold mb-4 text-azul-claro">Datos Básicos</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="space-y-2">
            <label class="block font-medium" for="categoria">
              Categoría <span class="text-rosa">*</span>
            </label>
            <select 
              id="categoria" 
              name="categoria" 
              class="w-full p-2 border border-border rounded-md bg-background focus:ring-2 focus:ring-azul-claro/50 focus:border-azul-claro outline-none transition-all"
              required
            >
              <option value="">Seleccionar categoría</option>
              <option value="1">Ropa (0-6 meses)</option>
              <option value="2">Ropa (6-12 meses)</option>
              <option value="3">Ropa (1-3 años)</option>
              <option value="4">Juguetes</option>
              <option value="5">Cunas y Muebles</option>
              <option value="6">Sillas de Coche</option>
              <option value="7">Cochecitos</option>
              <option value="8">Accesorios de Baño</option>
              <option value="9">Accesorios de Alimentación</option>
            </select>
          </div>
          
          <div class="space-y-2">
            <label class="block font-medium" for="marca">
              Marca <span class="text-rosa">*</span>
            </label>
            <input 
              type="text" 
              id="marca" 
              name="marca" 
              class="w-full p-2 border border-border rounded-md bg-background focus:ring-2 focus:ring-azul-claro/50 focus:border-azul-claro outline-none transition-all"
              placeholder="Ej: Chicco, Fisher-Price, etc." 
              required
            />
          </div>
          
          <div class="space-y-2">
            <label class="block font-medium" for="modelo">
              Modelo
            </label>
            <input 
              type="text" 
              id="modelo" 
              name="modelo" 
              class="w-full p-2 border border-border rounded-md bg-background focus:ring-2 focus:ring-azul-claro/50 focus:border-azul-claro outline-none transition-all"
              placeholder="Modelo del artículo" 
            />
          </div>
          
          <div class="space-y-2">
            <label class="block font-medium" for="edad">
              Edad Recomendada
            </label>
            <input 
              type="text" 
              id="edad" 
              name="edad" 
              class="w-full p-2 border border-border rounded-md bg-background focus:ring-2 focus:ring-azul-claro/50 focus:border-azul-claro outline-none transition-all"
              placeholder="Ej: 0-6 meses, 1-3 años" 
            />
          </div>
        </div>
      </div>
      
      <!-- Estado y condición -->
      <div class="bg-background-alt p-6 rounded-lg shadow-sm border border-border">
        <h2 class="text-xl font-heading font-bold mb-4 text-azul-claro">Estado y Condición</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="space-y-2">
            <label class="block font-medium" for="estado">
              Estado <span class="text-rosa">*</span>
            </label>
            <select 
              id="estado" 
              name="estado" 
              class="w-full p-2 border border-border rounded-md bg-background focus:ring-2 focus:ring-azul-claro/50 focus:border-azul-claro outline-none transition-all"
              required
            >
              <option value="">Seleccionar estado</option>
              <option value="5">Como nuevo (apenas usado)</option>
              <option value="4">Muy bueno (mínimo desgaste)</option>
              <option value="3">Bueno (con signos de uso)</option>
              <option value="2">Regular (desgaste visible)</option>
              <option value="1">Para reparar (necesita arreglos)</option>
            </select>
          </div>
          
          <div class="space-y-2">
            <label class="block font-medium">
              Defectos o Detalles
            </label>
            <div class="flex flex-wrap gap-3 pt-2">
              <label class="inline-flex items-center">
                <input type="checkbox" name="defectos" value="manchas" class="rounded text-azul-claro border-border focus:ring-azul-claro/50 mr-2">
                Manchas
              </label>
              <label class="inline-flex items-center">
                <input type="checkbox" name="defectos" value="rayones" class="rounded text-azul-claro border-border focus:ring-azul-claro/50 mr-2">
                Rayones
              </label>
              <label class="inline-flex items-center">
                <input type="checkbox" name="defectos" value="roturas" class="rounded text-azul-claro border-border focus:ring-azul-claro/50 mr-2">
                Roturas menores
              </label>
              <label class="inline-flex items-center">
                <input type="checkbox" name="defectos" value="piezas" class="rounded text-azul-claro border-border focus:ring-azul-claro/50 mr-2">
                Piezas faltantes
              </label>
            </div>
          </div>
        </div>
        
        <div class="mt-4 space-y-2">
          <label class="block font-medium" for="observaciones">
            Observaciones
          </label>
          <textarea 
            id="observaciones" 
            name="observaciones" 
            rows="3" 
            class="w-full p-2 border border-border rounded-md bg-background focus:ring-2 focus:ring-azul-claro/50 focus:border-azul-claro outline-none transition-all"
            placeholder="Describa cualquier detalle adicional sobre el estado del artículo..."
          ></textarea>
        </div>
      </div>
      
      <!-- Fotos -->
      <div class="bg-background-alt p-6 rounded-lg shadow-sm border border-border">
        <h2 class="text-xl font-heading font-bold mb-4 text-azul-claro">Fotografías</h2>
        <ImageUploader id="upload-photos" maxFiles={5} maxFileSize={5} />
      </div>
      
      <!-- Precio y botones -->
      <div class="bg-rosa/5 p-6 rounded-lg border border-rosa/20">
        <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4">
          <div>
            <h2 class="text-xl font-heading font-bold text-rosa mb-1">Precio Sugerido</h2>
            <p class="text-text-muted text-sm">Basado en los datos introducidos y nuestro algoritmo de valuación</p>
          </div>
          
          <div class="text-center bg-white dark:bg-gray-800 shadow-md rounded-lg py-3 px-6 border border-border">
            <span class="block text-sm text-text-muted">Rango de precio</span>
            <span class="text-2xl font-bold text-rosa">$0.00 - $0.00</span>
          </div>
        </div>
      </div>
      
      <div class="flex justify-between pt-4 border-t border-border">
        <button type="button" class="px-5 py-2 border border-border bg-background rounded-md hover:bg-background-alt transition-colors">
          Cancelar
        </button>
        
        <div class="space-x-3">
          <button type="button" class="px-5 py-2 border border-border bg-background rounded-md hover:bg-background-alt transition-colors">
            Guardar borrador
          </button>
          
          <button type="submit" class="px-5 py-2 bg-azul-claro text-white rounded-md hover:bg-azul-profundo transition-colors">
            Valorar artículo
          </button>
        </div>
      </div>
    </form>
  </div>
</MainLayout>

<script>
  // Scripts para manejar la carga de fotografías
  document.addEventListener('DOMContentLoaded', () => {
    const fileInput = document.getElementById('upload-photos') as HTMLInputElement;
    const previewContainer = document.querySelector('.photo-preview');
    
    fileInput?.addEventListener('change', function() {
      if (this.files && this.files.length > 0) {
        previewContainer?.classList.remove('hidden');
        
        // Mostrar una vista previa de cada imagen
        for (let i = 0; i < Math.min(this.files.length, 5); i++) {
          const file = this.files[i];
          const reader = new FileReader();
          
          reader.onload = function(e) {
            const div = document.createElement('div');
            div.className = 'relative aspect-square rounded-lg overflow-hidden bg-background-alt';
            
            const img = document.createElement('img');
            img.src = e.target?.result as string;
            img.className = 'w-full h-full object-cover';
            
            const removeBtn = document.createElement('button');
            removeBtn.className = 'absolute top-1 right-1 bg-rosa text-white rounded-full w-6 h-6 flex items-center justify-center';
            removeBtn.innerHTML = '×';
            removeBtn.type = 'button';
            
            div.appendChild(img);
            div.appendChild(removeBtn);
            previewContainer?.appendChild(div);
          }
          
          reader.readAsDataURL(file);
        }
      }
    });
  });
</script> 