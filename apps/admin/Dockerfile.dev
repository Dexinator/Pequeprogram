# Usar Node.js como base
FROM node:20-alpine

# Establecer directorio de trabajo
WORKDIR /app

# Instalar pnpm globalmente
RUN npm install -g pnpm

# Copiar archivos de dependencias primero (mejor cache)
COPY package*.json ./
COPY pnpm-lock.yaml* ./

# Instalar dependencias
RUN pnpm install --frozen-lockfile || pnpm install

# Copiar archivos de configuración si existen
COPY astro.config.mjs* ./
COPY tailwind.config.mjs* ./
COPY tsconfig.json* ./
COPY .env* ./

# Crear directorios necesarios
RUN mkdir -p src public

# Copiar código fuente
COPY src ./src
COPY public ./public

# Puerto que usará Astro
EXPOSE 4322

# Comando para ejecutar en modo desarrollo
CMD ["pnpm", "run", "dev", "--host", "0.0.0.0", "--port", "4322"]